package com.kfouri.opentest.ui.viewmodel

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import com.kfouri.opentest.api.Resource
import com.kfouri.opentest.api.model.HeroResponse
import com.kfouri.opentest.model.IHeroApiModel
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Job
import kotlinx.coroutines.launch

class HeroDetailViewModel(
    private val model: IHeroApiModel
): ViewModel(), CoroutineScope {

    override val coroutineContext = Job()

    private val heroDetailMutableLiveData = MutableLiveData<Resource<HeroResponse>>()
    val heroDetailLiveData: LiveData<Resource<HeroResponse>>
        get() = heroDetailMutableLiveData

    fun getHeroDetail(id: String) {
        launch {
            heroDetailMutableLiveData.postValue(Resource.loading(data = null))
            try {
                heroDetailMutableLiveData.postValue(
                    model.getHeroDetail(id)
                )
            } catch (e: Exception) {
                heroDetailMutableLiveData.postValue(
                    Resource.error(data = null, message = e.message ?: "Error getting Hero Detail")
                )
            }
        }
    }
}